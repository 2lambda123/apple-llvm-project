# UNSUPPORTED: darwin, freebsd
BINGO: BINGO
RUN: %cpp_compiler %S/SimpleTest.cpp -o %t-SimpleTest
RUN: not %run %t-SimpleTest -fork=1  > %t-SimpleTest.out 2>&1
RUN: FileCheck %s --check-prefix=BINGO --dump-input-on-failure < %t-SimpleTest.out

TIMEOUT: ERROR: libFuzzer: timeout
RUN: %cpp_compiler %S/TimeoutTest.cpp -o %t-TimeoutTest
RUN: not %run %t-TimeoutTest -fork=1 -timeout=1 -ignore_timeouts=0  > %t-TimeoutTest.out 2>&1
RUN: FileCheck %s --check-prefix=TIMEOUT --dump-input-on-failure < %t-TimeoutTest.out

OOM: ERROR: libFuzzer: out-of-memory
RUN: %cpp_compiler %S/OutOfMemoryTest.cpp -o %t-OutOfMemoryTest
RUN: not %run %t-OutOfMemoryTest -fork=1 -ignore_ooms=0  -rss_limit_mb=128  > %t-OutOfMemoryTest.out 2>&1
RUN: FileCheck %s --check-prefix=OOM --dump-input-on-failure < %t-OutOfMemoryTest.out

# access-violation is the error thrown on Windows. Address will be smaller on i386.
CRASH: {{SEGV|access-violation}} on unknown address 0x00000000
RUN: %cpp_compiler %S/ShallowOOMDeepCrash.cpp -o %t-ShallowOOMDeepCrash
RUN: not %run %t-ShallowOOMDeepCrash -fork=1 -rss_limit_mb=128 > %t-ShallowOOMDeepCrash.out  2>&1
RUN: FileCheck %s --check-prefix=CRASH --dump-input-on-failure < %t-ShallowOOMDeepCrash.out

MAX_TOTAL_TIME: INFO: fuzzed for {{.*}} seconds, wrapping up soon
MAX_TOTAL_TIME: INFO: exiting: {{.*}} time:
RUN: not %run %t-ShallowOOMDeepCrash -fork=1 -rss_limit_mb=128 -ignore_crashes=1 -max_total_time=10  > %t-ShallowOOMDeepCrash-2.out 2>&1
RUN: FileCheck %s --dump-input-on-failure --check-prefix=MAX_TOTAL_TIME < %t-ShallowOOMDeepCrash-2.out
